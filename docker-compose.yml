    version: "3.9"
    services:
    db:
    image: postgres:15-alpine
    environment:
    POSTGRES_USER: postgres
    POSTGRES_PASSWORD: postgres
    POSTGRES_DB: support
    volumes:
        pgdata:/var/lib/postgresql/data
        healthcheck:
        test: ["CMD-SHELL", "pg_isready -U postgres"]
        interval: 5s
        retries: 5

bot:
build: .
env_file: .env
depends_on:
db:
condition: service_healthy
volumes:
- ./bot:/app/bot
command: >
sh -c "alembic upgrade head &&
python -m bot.main"
volumes:
pgdata: